{"version":3,"sources":["../../../src/redux/reducers/components.ts"],"names":["programStatus","componentsReducer","state","Map","action","type","payload","component","get","componentPath","componentChunkName","query","pages","Set","isInBootstrap","serverData","config","add","path","set","delete"],"mappings":"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","sourcesContent":["import normalize from \"../../utils/normalize-path\"\nimport { IGatsbyState, ActionsUnion } from \"../types\"\n\nlet programStatus = `BOOTSTRAPPING`\n\n// TODO: replace usages of this reducer with queries.trackedComponents\n//  It is here merely for compatibility.\nexport const componentsReducer = (\n  state: IGatsbyState[\"components\"] = new Map(),\n  action: ActionsUnion\n): IGatsbyState[\"components\"] => {\n  switch (action.type) {\n    case `DELETE_CACHE`:\n      return new Map()\n    case `SET_PROGRAM_STATUS`:\n      programStatus = action.payload\n      return state\n    case `CREATE_PAGE`: {\n      // Create XState service.\n      let component = state.get(action.payload.componentPath)\n      if (!component) {\n        component = {\n          componentPath: action.payload.componentPath,\n          componentChunkName: action.payload.componentChunkName,\n          query: ``,\n          pages: new Set(),\n          isInBootstrap: true,\n          serverData: false,\n          config: false,\n        }\n      }\n      component.pages.add(action.payload.path)\n      component.isInBootstrap = programStatus === `BOOTSTRAPPING`\n      state.set(action.payload.componentPath, component)\n      return state\n    }\n    case `QUERY_EXTRACTED`: {\n      action.payload.componentPath = normalize(action.payload.componentPath)\n      const component = state.get(action.payload.componentPath)!\n      component.query = action.payload.query\n      state.set(action.payload.componentPath, component)\n      return state\n    }\n    case `REMOVE_STATIC_QUERIES_BY_TEMPLATE`: {\n      action.payload.componentPath = normalize(action.payload.componentPath)\n      state.delete(action.payload.componentPath)\n      return state\n    }\n    case `SET_COMPONENT_FEATURES`: {\n      const path = normalize(action.payload.componentPath)\n      const component = state.get(path)\n      if (component) {\n        component.serverData = action.payload.serverData\n        component.config = action.payload.config\n      }\n      return state\n    }\n    case `DELETE_PAGE`: {\n      const component = state.get(normalize(action.payload.component))!\n      component.pages.delete(action.payload.path)\n      return state\n    }\n  }\n\n  return state\n}\n"],"file":"components.js"}