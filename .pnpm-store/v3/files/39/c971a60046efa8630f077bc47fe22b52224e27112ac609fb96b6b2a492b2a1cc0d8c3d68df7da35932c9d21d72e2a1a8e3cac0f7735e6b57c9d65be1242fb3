{"version":3,"sources":["../../../src/redux/actions/add-page-dependency.ts"],"names":["createPageDependencyBatcher","Batcher","bulkCall","createCalls","dependencyPayloads","map","call","store","dispatch","createPageDependency","path","nodeId","connection","queries","getState","nodeDependencyExists","connectionDependencyExists","byNode","has","get","byConnection","add"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAKO,MAAMA,2BAA2B,GAAG,IAAIC,gBAAJ,CAEzC,IAFyC,CAApC;;AAIPD,2BAA2B,CAACE,QAA5B,CAAqCC,WAAW,IAAI;AAClD,QAAMC,kBAAkB,GAAGD,WAAW,CAACE,GAAZ,CAAgBC,IAAI,IAAIA,IAAI,CAAC,CAAD,CAA5B,CAA3B;;AACAC,UAAMC,QAAN,CAAe,sCAA+BJ,kBAA/B,CAAf;AACD,CAHD;;AAKO,MAAMK,oBAAoB,GAAG,CAAC;AACnCC,EAAAA,IADmC;AAEnCC,EAAAA,MAFmC;AAGnCC,EAAAA;AAHmC,CAAD,KAQxB;AACV,QAAM;AAAEC,IAAAA;AAAF,MAAcN,QAAMO,QAAN,EAApB,CADU,CAGV;AACA;;;AACA,MAAIC,oBAAoB,GAAG,KAA3B;AACA,MAAIC,0BAA0B,GAAG,KAAjC;;AACA,MAAI,CAACL,MAAL,EAAa;AACXI,IAAAA,oBAAoB,GAAG,IAAvB;AACD;;AACD,MACEJ,MAAM,IACNE,OAAO,CAACI,MAAR,CAAeC,GAAf,CAAmBP,MAAnB,CADA,IAEAE,OAAO,CAACI,MAAR,CAAeE,GAAf,CAAmBR,MAAnB,EAA4BO,GAA5B,CAAgCR,IAAhC,CAHF,EAIE;AACAK,IAAAA,oBAAoB,GAAG,IAAvB;AACD;;AACD,MAAI,CAACH,UAAL,EAAiB;AACfI,IAAAA,0BAA0B,GAAG,IAA7B;AACD;;AACD,MACEJ,UAAU,IACVC,OAAO,CAACO,YAAR,CAAqBF,GAArB,CAAyBN,UAAzB,CADA,IAEAC,OAAO,CAACO,YAAR,CAAqBD,GAArB,CAAyBP,UAAzB,EAAsCM,GAAtC,CAA0CR,IAA1C,CAHF,EAIE;AACAM,IAAAA,0BAA0B,GAAG,IAA7B;AACD;;AACD,MAAID,oBAAoB,IAAIC,0BAA5B,EAAwD;AACtD;AACD,GA7BS,CA+BV;;;AACAhB,EAAAA,2BAA2B,CAACqB,GAA5B,CAAgC;AAAEX,IAAAA,IAAF;AAAQC,IAAAA,MAAR;AAAgBC,IAAAA;AAAhB,GAAhC;AACD,CAzCM","sourcesContent":["import { store } from \"../\"\nimport Batcher from \"../../utils/batcher\"\nimport {\n  createPageDependency as internalCreatePageDependency,\n  createPageDependencies as internalCreatePageDependencies,\n} from \"./internal\"\n\nexport const createPageDependencyBatcher = new Batcher<\n  typeof internalCreatePageDependency\n>(1000)\n\ncreatePageDependencyBatcher.bulkCall(createCalls => {\n  const dependencyPayloads = createCalls.map(call => call[0])\n  store.dispatch(internalCreatePageDependencies(dependencyPayloads))\n})\n\nexport const createPageDependency = ({\n  path,\n  nodeId,\n  connection,\n}: {\n  path: string\n  nodeId: string\n  connection?: string\n}): void => {\n  const { queries } = store.getState()\n\n  // Check that the dependencies aren't already recorded so we\n  // can avoid creating lots of very noisy actions.\n  let nodeDependencyExists = false\n  let connectionDependencyExists = false\n  if (!nodeId) {\n    nodeDependencyExists = true\n  }\n  if (\n    nodeId &&\n    queries.byNode.has(nodeId) &&\n    queries.byNode.get(nodeId)!.has(path)\n  ) {\n    nodeDependencyExists = true\n  }\n  if (!connection) {\n    connectionDependencyExists = true\n  }\n  if (\n    connection &&\n    queries.byConnection.has(connection) &&\n    queries.byConnection.get(connection)!.has(path)\n  ) {\n    connectionDependencyExists = true\n  }\n  if (nodeDependencyExists && connectionDependencyExists) {\n    return\n  }\n\n  // It's new, let's dispatch it\n  createPageDependencyBatcher.add({ path, nodeId, connection })\n}\n"],"file":"add-page-dependency.js"}