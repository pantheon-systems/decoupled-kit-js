{"version":3,"sources":["../../../../src/steps/create-schema-customization/transform-fields/default-resolver.js"],"names":["buildDefaultResolver","transformerApi","source","_","context","fieldName","field","gatsbyNodeTypes","finalFieldValue","resolvedField","autoAliasedFieldPropertyName","type","name","aliasedField","typeName","autoAliasedFieldName","aliasedField2","__typename","isANodeConnection","id","Object","keys","length","includes","gatsbyNodeResolver"],"mappings":";;;;;AAAA;;AAEA;;AAGO,MAAMA,oBAAoB,GAAGC,cAAc,IAAI,CAACC,MAAD,EAASC,CAAT,EAAYC,OAAZ,KAAwB;AAAA;;AAC5E,QAAM;AAAEC,IAAAA,SAAF;AAAaC,IAAAA,KAAb;AAAoBC,IAAAA;AAApB,MAAwCN,cAA9C;AAEA,MAAIO,eAAJ;AAEA,QAAMC,aAAa,GAAGP,MAAM,CAACG,SAAD,CAA5B;;AAEA,MAAI,OAAOI,aAAP,KAA0B,WAA9B,EAA0C;AACxCD,IAAAA,eAAe,GAAGC,aAAlB;AACD;;AAED,QAAMC,4BAA4B,GAAI,GAAEL,SAAU,cAAaC,KAA1B,aAA0BA,KAA1B,sCAA0BA,KAAK,CAAEK,IAAjC,gDAA0B,YAAaC,IAAK,EAAjF;AAEA,QAAMC,YAAY,GAAGX,MAAM,CAACQ,4BAAD,CAA3B;;AAEA,MACE,OAAOD,aAAP,KAA0B,WAA1B,IACA,OAAOI,YAAP,KAAyB,WAF3B,EAGE;AACAL,IAAAA,eAAe,GAAGK,YAAlB;AACD,GApB2E,CAsB5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,QAAMC,QAAQ,GAAG,2BAAaR,KAAK,CAACK,IAAnB,CAAjB;AACA,QAAMI,oBAAoB,GAAI,GAAEV,SAAU,cAAaS,QAAS,EAAhE;AAEA,QAAME,aAAa,GAAGd,MAAM,CAACa,oBAAD,CAA5B;;AAEA,MACE,OAAON,aAAP,KAA0B,WAA1B,IACA,OAAOO,aAAP,KAA0B,WAF5B,EAGE;AACAR,IAAAA,eAAe,GAAGQ,aAAlB;AACD;;AAED,0BAAIR,eAAJ,6CAAI,iBAAiBS,UAArB,EAAiC;AAC/B;AACA;AACAT,IAAAA,eAAe,CAACS,UAAhB,GAA6B,4BAAcT,eAAe,CAACS,UAA9B,CAA7B;AACD;;AAED,QAAMC,iBAAiB,GACrB;AACA,wBAAAV,eAAe,UAAf,8DAAiBW,EAAjB,2BACAX,eADA,sDACA,kBAAiBS,UADjB,KAEAG,MAAM,CAACC,IAAP,CAAYb,eAAZ,EAA6Bc,MAA7B,KAAwC,CAFxC,IAGA;AACAf,EAAAA,eAAe,CAACgB,QAAhB,CAAyBf,eAAe,CAACS,UAAzC,CANF;;AAQA,MAAIC,iBAAJ,EAAuB;AACrB,UAAMM,kBAAkB,GAAG,oDAA8BvB,cAA9B,CAA3B;AACA,WAAOuB,kBAAkB,CAACtB,MAAD,EAASC,CAAT,EAAYC,OAAZ,CAAzB;AACD;;AAED,SAAOI,eAAP;AACD,CA/DM","sourcesContent":["import { findTypeName } from \"~/steps/create-schema-customization/helpers\"\n\nimport { buildGatsbyNodeObjectResolver } from \"~/steps/create-schema-customization/transform-fields/transform-object\"\nimport { buildTypeName } from \"../helpers\"\n\nexport const buildDefaultResolver = transformerApi => (source, _, context) => {\n  const { fieldName, field, gatsbyNodeTypes } = transformerApi\n\n  let finalFieldValue\n\n  const resolvedField = source[fieldName]\n\n  if (typeof resolvedField !== `undefined`) {\n    finalFieldValue = resolvedField\n  }\n\n  const autoAliasedFieldPropertyName = `${fieldName}__typename_${field?.type?.name}`\n\n  const aliasedField = source[autoAliasedFieldPropertyName]\n\n  if (\n    typeof resolvedField === `undefined` &&\n    typeof aliasedField !== `undefined`\n  ) {\n    finalFieldValue = aliasedField\n  }\n\n  // the findTypeName helpers was written after this resolver\n  // had been in production for a while.\n  // so we don't know if in all cases it will find the right typename\n  // for this resolver..\n  // So the old way of doing it is above in autoAliasedFieldPropertyName\n  // @todo write comprehesive data resolution integration tests\n  // using many different WPGraphQL extensions\n  // then come back and remove the `return aliasedField` line and\n  // see if this still resolves everything properly\n  const typeName = findTypeName(field.type)\n  const autoAliasedFieldName = `${fieldName}__typename_${typeName}`\n\n  const aliasedField2 = source[autoAliasedFieldName]\n\n  if (\n    typeof resolvedField === `undefined` &&\n    typeof aliasedField2 !== `undefined`\n  ) {\n    finalFieldValue = aliasedField2\n  }\n\n  if (finalFieldValue?.__typename) {\n    // in Gatsby V3 this property is used to determine the type of an interface field\n    // instead of the resolveType fn. This means we need to prefix it so that gql doesn't throw errors about missing types.\n    finalFieldValue.__typename = buildTypeName(finalFieldValue.__typename)\n  }\n\n  const isANodeConnection =\n    // if this field has just an id and typename\n    finalFieldValue?.id &&\n    finalFieldValue?.__typename &&\n    Object.keys(finalFieldValue).length === 2 &&\n    // and it's a Gatsby Node type\n    gatsbyNodeTypes.includes(finalFieldValue.__typename)\n\n  if (isANodeConnection) {\n    const gatsbyNodeResolver = buildGatsbyNodeObjectResolver(transformerApi)\n    return gatsbyNodeResolver(source, _, context)\n  }\n\n  return finalFieldValue\n}\n"],"file":"default-resolver.js"}