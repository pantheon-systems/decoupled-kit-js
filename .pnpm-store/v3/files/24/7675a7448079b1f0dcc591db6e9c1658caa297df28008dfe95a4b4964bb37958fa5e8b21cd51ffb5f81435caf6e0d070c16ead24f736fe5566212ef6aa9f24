{"version":3,"sources":["../../src/bootstrap/remove-stale-jobs.ts"],"names":["removeStaleJobs","jobs","actions","complete","forEach","job","contentDigest","push","internalActions","removeStaleJob","incomplete","createJobV2FromInternalJob"],"mappings":";;;;;AAMA;;AACA;;AAEO,MAAMA,eAAe,GAC1BC,IAD6B,IAEuC;AACpE,QAAMC,OAEL,GAAG,EAFJ,CADoE,CAKpE;;AACAD,EAAAA,IAAI,CAACE,QAAL,CAAcC,OAAd,CAAsB,CAACC,GAAD,EAAMC,aAAN,KAAwB;AAC5C,QAAI,yBAAWD,GAAX,CAAJ,EAAqB;AACnBH,MAAAA,OAAO,CAACK,IAAR,CAAaC,yBAAgBC,cAAhB,CAA+BH,aAA/B,CAAb;AACD;AACF,GAJD,EANoE,CAYpE;AACA;;AACAL,EAAAA,IAAI,CAACS,UAAL,CAAgBN,OAAhB,CAAwB,CAAC;AAAEC,IAAAA;AAAF,GAAD,KAAmB;AACzC,QAAI,yBAAWA,GAAX,CAAJ,EAAqB;AACnBH,MAAAA,OAAO,CAACK,IAAR,CAAaC,yBAAgBC,cAAhB,CAA+BJ,GAAG,CAACC,aAAnC,CAAb;AACD,KAFD,MAEO;AACLJ,MAAAA,OAAO,CAACK,IAAR,CAAaC,yBAAgBG,0BAAhB,CAA2CN,GAA3C,CAAb;AACD;AACF,GAND;AAQA,SAAOH,OAAP;AACD,CAzBM","sourcesContent":["import {\n  IGatsbyState,\n  IRemoveStaleJobV2Action,\n  ICreateJobV2FromInternalAction,\n} from \"../redux/types\"\n\nimport { isJobStale } from \"../utils/jobs/manager\"\nimport { internalActions } from \"../redux/actions\"\n\nexport const removeStaleJobs = (\n  jobs: IGatsbyState[\"jobsV2\"]\n): Array<IRemoveStaleJobV2Action | ICreateJobV2FromInternalAction> => {\n  const actions: Array<\n    IRemoveStaleJobV2Action | ICreateJobV2FromInternalAction\n  > = []\n\n  // If any of our finished jobs are stale we remove them to keep our cache small\n  jobs.complete.forEach((job, contentDigest) => {\n    if (isJobStale(job)) {\n      actions.push(internalActions.removeStaleJob(contentDigest))\n    }\n  })\n\n  // If any of our pending jobs do not have an existing inputPath or the inputPath changed\n  // we remove it from the queue as they would fail anyway\n  jobs.incomplete.forEach(({ job }): void => {\n    if (isJobStale(job)) {\n      actions.push(internalActions.removeStaleJob(job.contentDigest))\n    } else {\n      actions.push(internalActions.createJobV2FromInternalJob(job))\n    }\n  })\n\n  return actions\n}\n"],"file":"remove-stale-jobs.js"}