{"version":3,"sources":["../../src/utils/webpack-utils.ts"],"names":["vendorRegex","createWebpackUtils","stage","program","assetRelativeRoot","supportedBrowsers","directory","PRODUCTION","includes","isSSR","config","store","getState","makeExternalOnly","original","options","rule","include","makeInternalOnly","exclude","loaders","json","loader","require","resolve","yaml","null","raw","style","miniCssExtract","moduleOptions","undefined","modules","restOptions","namedExport","MiniCssExtractPlugin","css","modulesOptions","auto","localIdentName","exportLocalsConvention","exportOnlyLocals","url","startsWith","sourceMap","postcss","plugins","overrideBrowserslist","postcssOpts","execute","postcssOptions","loaderContext","postCSSPlugins","autoprefixerPlugin","flexbox","find","plugin","postcssPlugin","unshift","flexbugs","file","name","limit","fallback","js","reactRuntime","jsxRuntime","reactImportSource","jsxImportSource","cacheDirectory","path","join","rootDir","dependencies","rules","modulesThatUseGatsby","test","modulePath","some","module","type","use","issuer","configFile","compact","isPageTemplate","jsOptions","babelrc","presets","sourceMaps","cacheIdentifier","JSON","stringify","browsersList","gatsbyPreset","version","VENDORS_TO_NOT_POLYFILL","doNotPolyfillRegex","RegExp","fonts","images","media","miscAssets","browsers","importLoaders","filter","Boolean","internal","external","cssModules","builtinPlugins","minifyJs","terserOptions","TerserPlugin","ie8","mangle","safari10","parse","ecma","compress","output","parallel","Math","max","minifyCss","minimizerOptions","preset","svgo","full","CssMinimizerPlugin","fastRefresh","regExpToHack","ReactRefreshWebpackPlugin","overlay","sockIntegration","__dirname","extractText","moment","ignore","resourceRegExp","contextRegExp","extractStats","GatsbyWebpackStatsExtractor","eslintGraphqlSchemaReload","GatsbyWebpackEslintGraphqlSchemaReload","virtualModules","GatsbyWebpackVirtualModules","eslint","schema","extensions","VIRTUAL_MODULES_BASE_PATH","ESLintPlugin","eslintRequired","eslintRequiredConfig"],"mappings":";;;;;;;AAAA;;AAIA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAKA;;AAEA;;AACA;;;;;;AAiJA,MAAMA,WAAW,GAAG,iCAApB;AAEA;AACA;AACA;;AACO,MAAMC,kBAAkB,GAAG,CAChCC,KADgC,EAEhCC,OAFgC,KAGd;AAClB,QAAMC,iBAAiB,GAAI,SAA3B;AACA,QAAMC,iBAAiB,GAAG,mCAAgBF,OAAO,CAACG,SAAxB,CAA1B;AAEA,QAAMC,UAAU,GAAG,CAACL,KAAK,CAACM,QAAN,CAAgB,SAAhB,CAApB;AAEA,QAAMC,KAAK,GAAGP,KAAK,CAACM,QAAN,CAAgB,MAAhB,CAAd;;AACA,QAAM;AAAEE,IAAAA;AAAF,MAAaC,aAAMC,QAAN,EAAnB;;AAEA,QAAMC,gBAAgB,GACnBC,QAAD,IACA,CAACC,OAAO,GAAG,EAAX,KAA+B;AAC7B,UAAMC,IAAI,GAAGF,QAAQ,CAACC,OAAD,CAArB;AACAC,IAAAA,IAAI,CAACC,OAAL,GAAejB,WAAf;AACA,WAAOgB,IAAP;AACD,GANH;;AAQA,QAAME,gBAAgB,GACnBJ,QAAD,IACA,CAACC,OAAO,GAAG,EAAX,KAA+B;AAC7B,UAAMC,IAAI,GAAGF,QAAQ,CAACC,OAAD,CAArB;AACAC,IAAAA,IAAI,CAACG,OAAL,GAAenB,WAAf;AACA,WAAOgB,IAAP;AACD,GANH;;AAQA,QAAMI,OAAqB,GAAG;AAC5BC,IAAAA,IAAI,EAAE,CAACN,OAAO,GAAG,EAAX,KAAkB;AACtB,aAAO;AACLA,QAAAA,OADK;AAELO,QAAAA,MAAM,EAAEC,OAAO,CAACC,OAAR,CAAiB,aAAjB;AAFH,OAAP;AAID,KAN2B;AAO5BC,IAAAA,IAAI,EAAE,CAACV,OAAO,GAAG,EAAX,KAAkB;AACtB,aAAO;AACLA,QAAAA,OADK;AAELO,QAAAA,MAAM,EAAEC,OAAO,CAACC,OAAR,CAAiB,aAAjB;AAFH,OAAP;AAID,KAZ2B;AAc5BE,IAAAA,IAAI,EAAE,CAACX,OAAO,GAAG,EAAX,KAAkB;AACtB,aAAO;AACLA,QAAAA,OADK;AAELO,QAAAA,MAAM,EAAEC,OAAO,CAACC,OAAR,CAAiB,aAAjB;AAFH,OAAP;AAID,KAnB2B;AAqB5BG,IAAAA,GAAG,EAAE,CAACZ,OAAO,GAAG,EAAX,KAAkB;AACrB,aAAO;AACLA,QAAAA,OADK;AAELO,QAAAA,MAAM,EAAEC,OAAO,CAACC,OAAR,CAAiB,YAAjB;AAFH,OAAP;AAID,KA1B2B;AA4B5BI,IAAAA,KAAK,EAAE,CAACb,OAAO,GAAG,EAAX,KAAkB;AACvB,aAAO;AACLA,QAAAA,OADK;AAELO,QAAAA,MAAM,EAAEC,OAAO,CAACC,OAAR,CAAiB,cAAjB;AAFH,OAAP;AAID,KAjC2B;AAmC5B;AACAK,IAAAA,cAAc,EAAE,CACdd,OAEC,GAAG,EAHU,KAIX;AACH,UAAIe,aAAgD,GAAGC,SAAvD;AAEA,YAAM;AAAEC,QAAAA,OAAF;AAAW,WAAGC;AAAd,UAA8BlB,OAApC;;AAEA,UAAI,OAAOiB,OAAP,KAAoB,SAApB,IAAgCjB,OAAO,CAACiB,OAA5C,EAAqD;AACnDF,QAAAA,aAAa,GAAG;AACdI,UAAAA,WAAW,EAAE;AADC,SAAhB;AAGD,OAJD,MAIO;AACLJ,QAAAA,aAAa,GAAGE,OAAhB;AACD;;AAED,aAAO;AACLV,QAAAA,MAAM,EAAEa,8BAAqBb,MADxB;AAELP,QAAAA,OAAO,EAAE;AACPiB,UAAAA,OAAO,EAAEF,aADF;AAEP,aAAGG;AAFI;AAFJ,OAAP;AAOD,KA5D2B;AA8D5BG,IAAAA,GAAG,EAAE,CAACrB,OAAO,GAAG,EAAX,KAAkB;AACrB,UAAIsB,cAAiC,GAAG,KAAxC;;AACA,UAAItB,OAAO,CAACiB,OAAZ,EAAqB;AACnBK,QAAAA,cAAc,GAAG;AACfC,UAAAA,IAAI,EAAEP,SADS;AAEfG,UAAAA,WAAW,EAAE,IAFE;AAGfK,UAAAA,cAAc,EAAG,kCAHF;AAIfC,UAAAA,sBAAsB,EAAG,YAJV;AAKfC,UAAAA,gBAAgB,EAAEhC;AALH,SAAjB;;AAQA,YAAI,OAAOM,OAAO,CAACiB,OAAf,KAA4B,QAAhC,EAAyC;AACvCK,UAAAA,cAAc,GAAG,EACf,GAAGA,cADY;AAEf,eAAGtB,OAAO,CAACiB;AAFI,WAAjB;AAID;AACF;;AAED,aAAO;AACLV,QAAAA,MAAM,EAAEC,OAAO,CAACC,OAAR,CAAiB,YAAjB,CADH;AAELT,QAAAA,OAAO,EAAE;AACP;AACA2B,UAAAA,GAAG,EAAE,UAAUA,GAAV,EAAgC;AACnC;AACA,gBAAIA,GAAG,CAACC,UAAJ,CAAgB,GAAhB,CAAJ,EAAyB;AACvB,qBAAO,KAAP;AACD;;AAED,mBAAO,IAAP;AACD,WATM;AAUPC,UAAAA,SAAS,EAAE,CAACrC,UAVL;AAWPyB,UAAAA,OAAO,EAAEK;AAXF;AAFJ,OAAP;AAgBD,KAjG2B;AAmG5BQ,IAAAA,OAAO,EAAE,CAAC9B,OAAO,GAAG,EAAX,KAAkB;AACzB,YAAM;AACJ+B,QAAAA,OADI;AAEJC,QAAAA,oBAAoB,GAAG1C,iBAFnB;AAGJ,WAAG2C;AAHC,UAIFjC,OAJJ;AAMA,aAAO;AACLO,QAAAA,MAAM,EAAEC,OAAO,CAACC,OAAR,CAAiB,gBAAjB,CADH;AAELT,QAAAA,OAAO,EAAE;AACPkC,UAAAA,OAAO,EAAE,KADF;AAEPL,UAAAA,SAAS,EAAE,CAACrC,UAFL;AAGP;AACA2C,UAAAA,cAAc,EAAGC,aAAD,IAAwB;AAAA;;AACtC;AACA,gBAAIC,cAAoC,GAAG,EAA3C;;AACA,gBAAIN,OAAJ,EAAa;AACXM,cAAAA,cAAc,GACZ,OAAON,OAAP,KAAoB,UAApB,GAAgCA,OAAO,CAACK,aAAD,CAAvC,GAAyDL,OAD3D;AAED;;AAED,kBAAMO,kBAAkB,GAAG,2BAAa;AACtCN,cAAAA,oBADsC;AAEtCO,cAAAA,OAAO,EAAG,SAF4B;AAGtC,sDACEF,cAAc,CAACG,IAAf,CACEC,MAAM,IAAIA,MAAM,CAACC,aAAP,KAA0B,cADtC,CADF,yDAAI,qBAID1C,OAJH,+CAIc,EAJd;AAHsC,aAAb,CAA3B;AAUAqC,YAAAA,cAAc,CAACM,OAAf,CAAuBL,kBAAvB;AACAD,YAAAA,cAAc,CAACM,OAAf,CAAuBC,6BAAvB;AAEA,mBAAO;AACLb,cAAAA,OAAO,EAAEM,cADJ;AAEL,iBAAGJ;AAFE,aAAP;AAID;AA7BM;AAFJ,OAAP;AAkCD,KA5I2B;AA8I5BY,IAAAA,IAAI,EAAE,CAAC7C,OAAO,GAAG,EAAX,KAAkB;AACtB,aAAO;AACLO,QAAAA,MAAM,EAAEC,OAAO,CAACC,OAAR,CAAiB,aAAjB,CADH;AAELT,QAAAA,OAAO,EAAE;AACP8C,UAAAA,IAAI,EAAG,GAAEzD,iBAAkB,qBADpB;AAEP,aAAGW;AAFI;AAFJ,OAAP;AAOD,KAtJ2B;AAwJ5B2B,IAAAA,GAAG,EAAE,CAAC3B,OAAO,GAAG,EAAX,KAAkB;AACrB,aAAO;AACLO,QAAAA,MAAM,EAAEC,OAAO,CAACC,OAAR,CAAiB,YAAjB,CADH;AAELT,QAAAA,OAAO,EAAE;AACP+C,UAAAA,KAAK,EAAE,KADA;AAEPD,UAAAA,IAAI,EAAG,GAAEzD,iBAAkB,qBAFpB;AAGP2D,UAAAA,QAAQ,EAAExC,OAAO,CAACC,OAAR,CAAiB,aAAjB,CAHH;AAIP,aAAGT;AAJI;AAFJ,OAAP;AASD,KAlK2B;AAoK5BiD,IAAAA,EAAE,EAAEjD,OAAO,IAAI;AACb,aAAO;AACLA,QAAAA,OAAO,EAAE;AACPb,UAAAA,KADO;AAEP+D,UAAAA,YAAY,EAAEvD,MAAM,CAACwD,UAFd;AAGPC,UAAAA,iBAAiB,EAAEzD,MAAM,CAAC0D,eAHnB;AAIPC,UAAAA,cAAc,EAAEC,IAAI,CAACC,IAAL,CACdpE,OAAO,CAACG,SADM,EAEb,QAFa,EAGb,SAHa,EAIb,OAJa,CAJT;AAUP,aAAGS,OAVI;AAWPyD,UAAAA,OAAO,EAAErE,OAAO,CAACG;AAXV,SADJ;AAcLgB,QAAAA,MAAM,EAAEC,OAAO,CAACC,OAAR,CAAiB,gBAAjB;AAdH,OAAP;AAgBD,KArL2B;AAuL5BiD,IAAAA,YAAY,EAAE1D,OAAO,IAAI;AACvB,aAAO;AACLA,QAAAA,OAAO,EAAE;AACPsD,UAAAA,cAAc,EAAEC,IAAI,CAACC,IAAL,CACdpE,OAAO,CAACG,SADM,EAEb,QAFa,EAGb,SAHa,EAIb,OAJa,CADT;AAOP,aAAGS;AAPI,SADJ;AAULO,QAAAA,MAAM,EAAEC,OAAO,CAACC,OAAR,CAAiB,cAAjB;AAVH,OAAP;AAYD;AApM2B,GAA9B;AAuMA;AACF;AACA;;AACE,QAAMkD,KAAK,GAAG,EAAd;AAEA;AACF;AACA;AACA;;AACE;AACE,UAAMV,EAAE,GAAG,CAAC;AACVW,MAAAA,oBAAoB,GAAG,EADb;AAEV,SAAG5D;AAFO,QAKR,EALO,KAKa;AACtB,aAAO;AACL6D,QAAAA,IAAI,EAAE,wBADD;AAEL3D,QAAAA,OAAO,EAAG4D,UAAD,IAAiC;AACxC;AACA,cAAI,CAAC7E,WAAW,CAAC4E,IAAZ,CAAiBC,UAAjB,CAAL,EAAmC;AACjC,mBAAO,IAAP;AACD,WAJuC,CAMxC;AACA;;;AACA,iBAAOF,oBAAoB,CAACG,IAArB,CAA0BC,MAAM,IACrCF,UAAU,CAACrE,QAAX,CAAoBuE,MAAM,CAACT,IAA3B,CADK,CAAP;AAGD,SAbI;AAcLU,QAAAA,IAAI,EAAG,iBAdF;AAeLC,QAAAA,GAAG,EAAE,CAAC;AAAEC,UAAAA;AAAF,SAAD,KAAuC,CAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA9D,QAAAA,OAAO,CAAC4C,EAAR,CAAW,EACT,GAAGjD,OADM;AAEToE,UAAAA,UAAU,EAAE,IAFH;AAGTC,UAAAA,OAAO,EAAE7E,UAHA;AAIT8E,UAAAA,cAAc,EAAE,iBAAiBT,IAAjB,CAAsBM,MAAtB;AAJP,SAAX,CAV0C;AAfvC,OAAP;AAiCD,KAvCD;;AAwCAR,IAAAA,KAAK,CAACV,EAAN,GAAWA,EAAX;AACD;AAED;AACF;AACA;AACA;AACA;;AACE;AACE,UAAMS,YAAY,GAAG,CAAC;AACpBE,MAAAA,oBAAoB,GAAG;AADH,QAIlB,EAJiB,KAIG;AACtB,YAAMW,SAAS,GAAG;AAChBC,QAAAA,OAAO,EAAE,KADO;AAEhBJ,QAAAA,UAAU,EAAE,KAFI;AAGhBC,QAAAA,OAAO,EAAE,KAHO;AAIhBI,QAAAA,OAAO,EAAE,CACP,CACEjE,OAAO,CAACC,OAAR,CAAiB,kCAAjB,CADF,EAEE;AACEtB,UAAAA;AADF,SAFF,CADO,CAJO;AAYhB;AACA;AACA;AACA;AACAuF,QAAAA,UAAU,EAAE,KAhBI;AAkBhBC,QAAAA,eAAe,EAAEC,IAAI,CAACC,SAAL,CAAe;AAC9BC,UAAAA,YAAY,EAAExF,iBADgB;AAE9ByF,UAAAA,YAAY,EAAEvE,OAAO,CAAE,kCAAF,CAAP,CAA4CwE;AAF5B,SAAf;AAlBD,OAAlB,CADsB,CAyBtB;AACA;;AACA,YAAMC,uBAAuB,GAAG,CAC7B,sBAD6B,EAE7B,oCAF6B,EAG7B,qBAH6B,EAI7B,qBAJ6B,EAK7B,SAL6B,EAM7B,aAN6B,EAO7B,yBAP6B,EAQ7B,aAR6B,EAS7B,4BAT6B,EAU7B,WAV6B,EAW7B,QAX6B,EAY7B,MAZ6B,EAa7B,YAb6B,EAc7B,WAd6B,EAe7B,OAf6B,EAgB7B,qBAhB6B,EAiB7B,WAjB6B,EAkB7B,iBAlB6B,EAmB7B,iBAnB6B,EAoB7B,SApB6B,EAqB7B,SArB6B,CAAhC;AAuBA,YAAMC,kBAAkB,GAAG,IAAIC,MAAJ,CACxB,8BAA6BF,uBAAuB,CAACzB,IAAxB,CAC3B,GAD2B,CAE5B,UAHuB,CAA3B;AAMA,aAAO;AACLK,QAAAA,IAAI,EAAE,aADD;AAELzD,QAAAA,OAAO,EAAG0D,UAAD,IAAiC;AACxC;AACA,cAAI,CAAC7E,WAAW,CAAC4E,IAAZ,CAAiBC,UAAjB,CAAL,EAAmC;AACjC,mBAAO,IAAP;AACD,WAJuC,CAMxC;;;AACA,cACEF,oBAAoB,CAACG,IAArB,CAA0BC,MAAM,IAC9BF,UAAU,CAACrE,QAAX,CAAoBuE,MAAM,CAACT,IAA3B,CADF,CADF,EAIE;AACA,mBAAO,IAAP;AACD;;AAED,iBAAO2B,kBAAkB,CAACrB,IAAnB,CAAwBC,UAAxB,CAAP;AACD,SAlBI;AAmBLG,QAAAA,IAAI,EAAG,iBAnBF;AAoBLC,QAAAA,GAAG,EAAE,CAAC7D,OAAO,CAACqD,YAAR,CAAqBa,SAArB,CAAD;AApBA,OAAP;AAsBD,KAlFD;;AAmFAZ,IAAAA,KAAK,CAACD,YAAN,GAAqBA,YAArB;AACD;;AAEDC,EAAAA,KAAK,CAACjD,IAAN,GAAa,MAAmB;AAC9B,WAAO;AACLmD,MAAAA,IAAI,EAAE,UADD;AAELI,MAAAA,IAAI,EAAG,MAFF;AAGLC,MAAAA,GAAG,EAAE,CAAC7D,OAAO,CAACK,IAAR,EAAD;AAHA,KAAP;AAKD,GAND;AAQA;AACF;AACA;;;AACEiD,EAAAA,KAAK,CAACyB,KAAN,GAAc,MAAmB;AAC/B,WAAO;AACLlB,MAAAA,GAAG,EAAE,CAAC7D,OAAO,CAACsB,GAAR,EAAD,CADA;AAELkC,MAAAA,IAAI,EAAE;AAFD,KAAP;AAID,GALD;AAOA;AACF;AACA;AACA;;;AACEF,EAAAA,KAAK,CAAC0B,MAAN,GAAe,MAAmB;AAChC,WAAO;AACLnB,MAAAA,GAAG,EAAE,CAAC7D,OAAO,CAACsB,GAAR,EAAD,CADA;AAELkC,MAAAA,IAAI,EAAE;AAFD,KAAP;AAID,GALD;AAOA;AACF;AACA;AACA;;;AACEF,EAAAA,KAAK,CAAC2B,KAAN,GAAc,MAAmB;AAC/B,WAAO;AACLpB,MAAAA,GAAG,EAAE,CAAC7D,OAAO,CAACsB,GAAR,EAAD,CADA;AAELkC,MAAAA,IAAI,EAAE;AAFD,KAAP;AAID,GALD;AAOA;AACF;AACA;;;AACEF,EAAAA,KAAK,CAAC4B,UAAN,GAAmB,MAAmB;AACpC,WAAO;AACLrB,MAAAA,GAAG,EAAE,CAAC7D,OAAO,CAACwC,IAAR,EAAD,CADA;AAELgB,MAAAA,IAAI,EAAE;AAFD,KAAP;AAID,GALD;AAOA;AACF;AACA;;;AACE;AACE,UAAMxC,GAAsB,GAAG,CAACrB,OAAO,GAAG,EAAX,KAA+B;AAC5D,YAAM;AAAEwF,QAAAA,QAAF;AAAY,WAAGtE;AAAf,UAA+BlB,OAArC;AACA,YAAMkE,GAAG,GAAG,CACV,CAACxE,KAAD,IAAUW,OAAO,CAACS,cAAR,CAAuBI,WAAvB,CADA,EAEVb,OAAO,CAACgB,GAAR,CAAY,EAAE,GAAGH,WAAL;AAAkBuE,QAAAA,aAAa,EAAE;AAAjC,OAAZ,CAFU,EAGVpF,OAAO,CAACyB,OAAR,CAAgB;AAAE0D,QAAAA;AAAF,OAAhB,CAHU,EAIVE,MAJU,CAIHC,OAJG,CAAZ;AAMA,aAAO;AACLzB,QAAAA,GADK;AAELL,QAAAA,IAAI,EAAE;AAFD,OAAP;AAID,KAZD;AAcA;AACJ;AACA;;;AACIxC,IAAAA,GAAG,CAACuE,QAAJ,GAAezF,gBAAgB,CAACkB,GAAD,CAA/B;AACAA,IAAAA,GAAG,CAACwE,QAAJ,GAAe/F,gBAAgB,CAACuB,GAAD,CAA/B;;AAEA,UAAMyE,UAAoC,GAAI9F,OAAD,IAA0B;AACrE,YAAMC,IAAI,GAAGoB,GAAG,CAAC,EAAE,GAAGrB,OAAL;AAAciB,QAAAA,OAAO,EAAE;AAAvB,OAAD,CAAhB;AACA,aAAOhB,IAAI,CAACG,OAAZ;AACAH,MAAAA,IAAI,CAAC4D,IAAL,GAAY,gBAAZ;AACA,aAAO5D,IAAP;AACD,KALD;;AAOA0D,IAAAA,KAAK,CAACtC,GAAN,GAAYA,GAAZ;AACAsC,IAAAA,KAAK,CAACmC,UAAN,GAAmBA,UAAnB;AACD;AAED;AACF;AACA;;AACE;AACE,UAAMhE,OAA8B,GAAI9B,OAAD,IAA0B;AAC/D,aAAO;AACL6D,QAAAA,IAAI,EAAE,QADD;AAELK,QAAAA,GAAG,EAAE,CAAC7D,OAAO,CAACgB,GAAR,CAAY;AAAEoE,UAAAA,aAAa,EAAE;AAAjB,SAAZ,CAAD,EAAoCpF,OAAO,CAACyB,OAAR,CAAgB9B,OAAhB,CAApC;AAFA,OAAP;AAID,KALD;AAOA;AACJ;AACA;;;AACI8B,IAAAA,OAAO,CAAC8D,QAAR,GAAmBzF,gBAAgB,CAAC2B,OAAD,CAAnC;AACAA,IAAAA,OAAO,CAAC+D,QAAR,GAAmB/F,gBAAgB,CAACgC,OAAD,CAAnC;AACA6B,IAAAA,KAAK,CAAC7B,OAAN,GAAgBA,OAAhB;AACD;AACD;AACF;AACA;;AACE;AACF;AACA;;AACE,QAAMC,OAAO,GAAG,EAAE,GAAGgE;AAAL,GAAhB;;AAEAhE,EAAAA,OAAO,CAACiE,QAAR,GAAmB,CAAC;AAClBC,IAAAA,aADkB;AAElB,OAAGjG;AAFe,MAKhB,EALe,KAMjB,IAAIkG,4BAAJ,CAAiB;AACf9F,IAAAA,OAAO,EAAE,WADM;AAEf6F,IAAAA,aAAa,EAAE;AACbE,MAAAA,GAAG,EAAE,KADQ;AAEbC,MAAAA,MAAM,EAAE;AACNC,QAAAA,QAAQ,EAAE;AADJ,OAFK;AAKbC,MAAAA,KAAK,EAAE;AACLC,QAAAA,IAAI,EAAE;AADD,OALM;AAQbC,MAAAA,QAAQ,EAAE;AACRD,QAAAA,IAAI,EAAE;AADE,OARG;AAWbE,MAAAA,MAAM,EAAE;AACNF,QAAAA,IAAI,EAAE;AADA,OAXK;AAcb,SAAGN;AAdU,KAFA;AAkBfS,IAAAA,QAAQ,EAAEC,IAAI,CAACC,GAAL,CAAS,CAAT,EAAY,uCAAiB,CAA7B,CAlBK;AAmBf,OAAG5G;AAnBY,GAAjB,CANF;;AA4BA+B,EAAAA,OAAO,CAAC8E,SAAR,GAAoB,CAClB7G,OAAO,GAAG;AACR8G,IAAAA,gBAAgB,EAAE;AAChBC,MAAAA,MAAM,EAAE,CACL,SADK,EAEN;AACEC,QAAAA,IAAI,EAAE;AACJC,UAAAA,IAAI,EAAE,IADF;AAEJlF,UAAAA,OAAO,EAAE,CACP;AACA;AACA;AACA;AACC,wBALM,EAMN,yBANM,EAON,YAPM,EAQN,qBARM,EAQgB;AACtB,gCATM,EAUN,gBAVM,EAWN,eAXM,EAYN,iBAZM,EAaN,qBAbM,EAagB;AACtB,4BAdM,EAeN,cAfM,EAgBN,YAhBM,EAiBN,cAjBM,EAkBN,uBAlBM,EAmBN,uBAnBM,EAoBN,WApBM,EAoBM;AACZ,0BArBM,EAsBN,YAtBM,EAuBN,eAvBM,EAwBN,qBAxBM,EAyBN,kBAzBM,EA0BN,uBA1BM,EA2BN,iBA3BM,EA4BN,mBA5BM,EA6BN,gBA7BM,EA8BN,gCA9BM,EA+BN,sBA/BM,EA+BiB;AACvB,8BAhCM,EAgCe;AACrB,+BAjCM,EAiCgB;AACtB,8BAlCM,EAkCe;AACrB,uBAnCM,EAoCN,2BApCM,EAqCN,gBArCM,EAsCN,mBAtCM,EAuCN,4BAvCM,EAwCN,mBAxCM,EAyCN,YAzCM,EAyCO;AACb,qBA1CM,CA0CM;AA1CN;AAFL;AADR,OAFM;AADQ;AADV,GADQ,KA0DlB,IAAImF,kCAAJ,CAAuB;AACrBR,IAAAA,QAAQ,EAAEC,IAAI,CAACC,GAAL,CAAS,CAAT,EAAY,uCAAiB,CAA7B,CADW;AAErB,OAAG5G;AAFkB,GAAvB,CA1DF;;AA+DA+B,EAAAA,OAAO,CAACoF,WAAR,GAAsB,CAAC;AAAEvD,IAAAA;AAAF,GAAD,KAAqD;AACzE,UAAMwD,YAAY,GAAG,cAArB;;AACAA,IAAAA,YAAY,CAACvD,IAAb,GAAqBC,UAAD,IAAiC;AACnD;AACA,UAAI,CAAC7E,WAAW,CAAC4E,IAAZ,CAAiBC,UAAjB,CAAL,EAAmC;AACjC,eAAO,KAAP;AACD,OAJkD,CAMnD;AACA;;;AACA,aAAO,CAACF,oBAAoB,CAACG,IAArB,CAA0BC,MAAM,IACtCF,UAAU,CAACrE,QAAX,CAAoBuE,MAAM,CAACT,IAA3B,CADM,CAAR;AAGD,KAXD;;AAaA,WAAO,IAAI8D,kCAAJ,CAA8B;AACnCC,MAAAA,OAAO,EAAE;AACPC,QAAAA,eAAe,EAAG,KADX;AAEPvD,QAAAA,MAAM,EAAET,IAAI,CAACC,IAAL,CAAUgE,SAAV,EAAsB,qBAAtB;AAFD,OAD0B;AAKnC;AACA;AACA;AACApH,MAAAA,OAAO,EAAEgH;AAR0B,KAA9B,CAAP;AAUD,GAzBD;;AA2BArF,EAAAA,OAAO,CAAC0F,WAAR,GAAuBzH,OAAD,IACpB,IAAIoB,6BAAJ,CAAyB,EACvB,GAAGpB;AADoB,GAAzB,CADF;;AAKA+B,EAAAA,OAAO,CAAC2F,MAAR,GAAiB,MACf3F,OAAO,CAAC4F,MAAR,CAAe;AAAEC,IAAAA,cAAc,EAAE,cAAlB;AAAkCC,IAAAA,aAAa,EAAE;AAAjD,GAAf,CADF;;AAGA9F,EAAAA,OAAO,CAAC+F,YAAR,GAAuB,MACrB,IAAIC,wDAAJ,EADF;;AAGAhG,EAAAA,OAAO,CAACiG,yBAAR,GACE,MACE,IAAIC,oFAAJ,EAFJ;;AAIAlG,EAAAA,OAAO,CAACmG,cAAR,GAAyB,MACvB,IAAIC,wDAAJ,EADF;;AAGApG,EAAAA,OAAO,CAACqG,MAAR,GAAkBC,MAAD,IAAkD;AACjE,UAAMrI,OAAO,GAAG;AACdsI,MAAAA,UAAU,EAAE,CAAE,IAAF,EAAQ,KAAR,CADE;AAEdlI,MAAAA,OAAO,EAAE,CACN,gBADM,EAEN,oBAFM,EAGPmI,sDAHO,CAFK;AAOd,SAAG,gCAAaF,MAAb,EAAqB1I,MAAM,CAACwD,UAAP,KAAuB,WAA5C;AAPW,KAAhB,CADiE,CAUjE;;AACA,WAAO,IAAIqF,4BAAJ,CAAiBxI,OAAjB,CAAP;AACD,GAZD;;AAcA+B,EAAAA,OAAO,CAAC0G,cAAR,GAAyB,MAA6B;AACpD,UAAMzI,OAAO,GAAG;AACdsI,MAAAA,UAAU,EAAE,CAAE,IAAF,EAAQ,KAAR,CADE;AAEdlI,MAAAA,OAAO,EAAE,CACN,gBADM,EAEN,oBAFM,EAGPmI,sDAHO,CAFK;AAOd,SAAGG;AAPW,KAAhB,CADoD,CAUpD;;AACA,WAAO,IAAIF,4BAAJ,CAAiBxI,OAAjB,CAAP;AACD,GAZD;;AAcA,SAAO;AACLK,IAAAA,OADK;AAELsD,IAAAA,KAFK;AAGL5B,IAAAA;AAHK,GAAP;AAKD,CA5oBM","sourcesContent":["import * as path from \"path\"\nimport { RuleSetRule, WebpackPluginInstance } from \"webpack\"\nimport { GraphQLSchema } from \"graphql\"\nimport { Plugin as PostCSSPlugin } from \"postcss\"\nimport autoprefixer from \"autoprefixer\"\nimport flexbugs from \"postcss-flexbugs-fixes\"\nimport TerserPlugin from \"terser-webpack-plugin\"\nimport type { MinifyOptions as TerserOptions } from \"terser\"\nimport MiniCssExtractPlugin from \"mini-css-extract-plugin\"\nimport CssMinimizerPlugin from \"css-minimizer-webpack-plugin\"\nimport ReactRefreshWebpackPlugin from \"@pmmmwh/react-refresh-webpack-plugin\"\nimport { getBrowsersList } from \"./browserslist\"\nimport ESLintPlugin from \"eslint-webpack-plugin\"\nimport { cpuCoreCount } from \"gatsby-core-utils\"\nimport { GatsbyWebpackStatsExtractor } from \"./gatsby-webpack-stats-extractor\"\nimport { GatsbyWebpackEslintGraphqlSchemaReload } from \"./gatsby-webpack-eslint-graphql-schema-reload-plugin\"\nimport {\n  GatsbyWebpackVirtualModules,\n  VIRTUAL_MODULES_BASE_PATH,\n} from \"./gatsby-webpack-virtual-modules\"\n\nimport { builtinPlugins } from \"./webpack-plugins\"\nimport { IProgram, Stage } from \"../commands/types\"\nimport { eslintConfig, eslintRequiredConfig } from \"./eslint-config\"\nimport { store } from \"../redux\"\nimport type { RuleSetUseItem } from \"webpack\"\n\ntype Loader = string | { loader: string; options?: { [name: string]: any } }\ntype LoaderResolver<T = Record<string, unknown>> = (options?: T) => Loader\n\ntype LoaderOptions = Record<string, any>\ntype RuleFactory<T = Record<string, unknown>> = (\n  options?: T & LoaderOptions\n) => RuleSetRule\n\ntype ContextualRuleFactory<T = Record<string, unknown>> = RuleFactory<T> & {\n  internal?: RuleFactory<T>\n  external?: RuleFactory<T>\n}\n\ntype PluginFactory = (...args: any) => WebpackPluginInstance\n\ntype BuiltinPlugins = typeof builtinPlugins\n\ntype CSSModulesOptions =\n  | boolean\n  | string\n  | {\n      mode?:\n        | \"local\"\n        | \"global\"\n        | \"pure\"\n        | ((resourcePath: string) => \"local\" | \"global\" | \"pure\")\n      auto?: boolean\n      exportGlobals?: boolean\n      localIdentName?: string\n      localIdentContext?: string\n      localIdentHashPrefix?: string\n      namedExport?: boolean\n      exportLocalsConvention?:\n        | \"asIs\"\n        | \"camelCaseOnly\"\n        | \"camelCase\"\n        | \"dashes\"\n        | \"dashesOnly\"\n      exportOnlyLocals?: boolean\n    }\n\ntype MiniCSSExtractLoaderModuleOptions =\n  | undefined\n  | boolean\n  | {\n      namedExport?: boolean\n    }\n/**\n * Utils that produce webpack `loader` objects\n */\ninterface ILoaderUtils {\n  yaml: LoaderResolver\n  style: LoaderResolver\n  css: LoaderResolver<{\n    url?: boolean | ((url: string, resourcePath: string) => boolean)\n    import?:\n      | boolean\n      | ((url: string, media: string, resourcePath: string) => boolean)\n    modules?: CSSModulesOptions\n    sourceMap?: boolean\n    importLoaders?: number\n    esModule?: boolean\n  }>\n  postcss: LoaderResolver<{\n    browsers?: Array<string>\n    overrideBrowserslist?: Array<string>\n    plugins?: Array<PostCSSPlugin> | ((loader: Loader) => Array<PostCSSPlugin>)\n  }>\n\n  file: LoaderResolver\n  url: LoaderResolver\n  js: LoaderResolver\n  json: LoaderResolver\n  null: LoaderResolver\n  raw: LoaderResolver\n  dependencies: LoaderResolver\n\n  miniCssExtract: LoaderResolver\n  imports?: LoaderResolver\n  exports?: LoaderResolver\n}\n\ninterface IModuleThatUseGatsby {\n  name: string\n  path: string\n}\n\ntype CssLoaderModuleOption = boolean | Record<string, any> | string\n\n/**\n * Utils that produce webpack rule objects\n */\ninterface IRuleUtils {\n  /**\n   * Handles JavaScript compilation via babel\n   */\n  js: RuleFactory<{ modulesThatUseGatsby?: Array<IModuleThatUseGatsby> }>\n  dependencies: RuleFactory<{\n    modulesThatUseGatsby?: Array<IModuleThatUseGatsby>\n  }>\n  yaml: RuleFactory\n  fonts: RuleFactory\n  images: RuleFactory\n  miscAssets: RuleFactory\n  media: RuleFactory\n\n  css: ContextualRuleFactory<{\n    browsers?: Array<string>\n    modules?: CssLoaderModuleOption\n  }>\n  cssModules: RuleFactory\n  postcss: ContextualRuleFactory<{ overrideBrowserOptions: Array<string> }>\n\n  eslint: (schema: GraphQLSchema) => RuleSetRule\n  eslintRequired: () => RuleSetRule\n}\n\ntype PluginUtils = BuiltinPlugins & {\n  extractText: PluginFactory\n  uglify: PluginFactory\n  moment: PluginFactory\n  extractStats: PluginFactory\n  minifyJs: PluginFactory\n  minifyCss: PluginFactory\n  fastRefresh: PluginFactory\n  eslintGraphqlSchemaReload: PluginFactory\n  virtualModules: PluginFactory\n  eslint: PluginFactory\n  eslintRequired: PluginFactory\n}\n\n/**\n * webpack atoms namespace\n */\ninterface IWebpackUtils {\n  loaders: ILoaderUtils\n\n  rules: IRuleUtils\n\n  plugins: PluginUtils\n}\n\nconst vendorRegex = /(node_modules|bower_components)/\n\n/**\n * A factory method that produces an atoms namespace\n */\nexport const createWebpackUtils = (\n  stage: Stage,\n  program: IProgram\n): IWebpackUtils => {\n  const assetRelativeRoot = `static/`\n  const supportedBrowsers = getBrowsersList(program.directory)\n\n  const PRODUCTION = !stage.includes(`develop`)\n\n  const isSSR = stage.includes(`html`)\n  const { config } = store.getState()\n\n  const makeExternalOnly =\n    (original: RuleFactory) =>\n    (options = {}): RuleSetRule => {\n      const rule = original(options)\n      rule.include = vendorRegex\n      return rule\n    }\n\n  const makeInternalOnly =\n    (original: RuleFactory) =>\n    (options = {}): RuleSetRule => {\n      const rule = original(options)\n      rule.exclude = vendorRegex\n      return rule\n    }\n\n  const loaders: ILoaderUtils = {\n    json: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`json-loader`),\n      }\n    },\n    yaml: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`yaml-loader`),\n      }\n    },\n\n    null: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`null-loader`),\n      }\n    },\n\n    raw: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`raw-loader`),\n      }\n    },\n\n    style: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`style-loader`),\n      }\n    },\n\n    // TODO(v5): Re-Apply https://github.com/gatsbyjs/gatsby/pull/33979 with breaking change in inline loader syntax\n    miniCssExtract: (\n      options: {\n        modules?: MiniCSSExtractLoaderModuleOptions\n      } = {}\n    ) => {\n      let moduleOptions: MiniCSSExtractLoaderModuleOptions = undefined\n\n      const { modules, ...restOptions } = options\n\n      if (typeof modules === `boolean` && options.modules) {\n        moduleOptions = {\n          namedExport: true,\n        }\n      } else {\n        moduleOptions = modules\n      }\n\n      return {\n        loader: MiniCssExtractPlugin.loader,\n        options: {\n          modules: moduleOptions,\n          ...restOptions,\n        },\n      }\n    },\n\n    css: (options = {}) => {\n      let modulesOptions: CSSModulesOptions = false\n      if (options.modules) {\n        modulesOptions = {\n          auto: undefined,\n          namedExport: true,\n          localIdentName: `[name]--[local]--[hash:base64:5]`,\n          exportLocalsConvention: `dashesOnly`,\n          exportOnlyLocals: isSSR,\n        }\n\n        if (typeof options.modules === `object`) {\n          modulesOptions = {\n            ...modulesOptions,\n            ...options.modules,\n          }\n        }\n      }\n\n      return {\n        loader: require.resolve(`css-loader`),\n        options: {\n          // Absolute urls (https or //) are not send to this function. Only resolvable paths absolute or relative ones.\n          url: function (url: string): boolean {\n            // When an url starts with /\n            if (url.startsWith(`/`)) {\n              return false\n            }\n\n            return true\n          },\n          sourceMap: !PRODUCTION,\n          modules: modulesOptions,\n        },\n      }\n    },\n\n    postcss: (options = {}) => {\n      const {\n        plugins,\n        overrideBrowserslist = supportedBrowsers,\n        ...postcssOpts\n      } = options\n\n      return {\n        loader: require.resolve(`postcss-loader`),\n        options: {\n          execute: false,\n          sourceMap: !PRODUCTION,\n          // eslint-disable-next-line @typescript-eslint/explicit-function-return-type\n          postcssOptions: (loaderContext: any) => {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            let postCSSPlugins: Array<PostCSSPlugin> = []\n            if (plugins) {\n              postCSSPlugins =\n                typeof plugins === `function` ? plugins(loaderContext) : plugins\n            }\n\n            const autoprefixerPlugin = autoprefixer({\n              overrideBrowserslist,\n              flexbox: `no-2009`,\n              ...((\n                postCSSPlugins.find(\n                  plugin => plugin.postcssPlugin === `autoprefixer`\n                ) as unknown as autoprefixer.ExportedAPI\n              )?.options ?? {}),\n            })\n\n            postCSSPlugins.unshift(autoprefixerPlugin)\n            postCSSPlugins.unshift(flexbugs)\n\n            return {\n              plugins: postCSSPlugins,\n              ...postcssOpts,\n            }\n          },\n        },\n      }\n    },\n\n    file: (options = {}) => {\n      return {\n        loader: require.resolve(`file-loader`),\n        options: {\n          name: `${assetRelativeRoot}[name]-[hash].[ext]`,\n          ...options,\n        },\n      }\n    },\n\n    url: (options = {}) => {\n      return {\n        loader: require.resolve(`url-loader`),\n        options: {\n          limit: 10000,\n          name: `${assetRelativeRoot}[name]-[hash].[ext]`,\n          fallback: require.resolve(`file-loader`),\n          ...options,\n        },\n      }\n    },\n\n    js: options => {\n      return {\n        options: {\n          stage,\n          reactRuntime: config.jsxRuntime,\n          reactImportSource: config.jsxImportSource,\n          cacheDirectory: path.join(\n            program.directory,\n            `.cache`,\n            `webpack`,\n            `babel`\n          ),\n          ...options,\n          rootDir: program.directory,\n        },\n        loader: require.resolve(`./babel-loader`),\n      }\n    },\n\n    dependencies: options => {\n      return {\n        options: {\n          cacheDirectory: path.join(\n            program.directory,\n            `.cache`,\n            `webpack`,\n            `babel`\n          ),\n          ...options,\n        },\n        loader: require.resolve(`babel-loader`),\n      }\n    },\n  }\n\n  /**\n   * Rules\n   */\n  const rules = {} as IRuleUtils\n\n  /**\n   * JavaScript loader via babel, includes userland code\n   * and packages that depend on `gatsby`\n   */\n  {\n    const js = ({\n      modulesThatUseGatsby = [],\n      ...options\n    }: {\n      modulesThatUseGatsby?: Array<IModuleThatUseGatsby>\n    } = {}): RuleSetRule => {\n      return {\n        test: /\\.(js|mjs|jsx|ts|tsx)$/,\n        include: (modulePath: string): boolean => {\n          // when it's not coming from node_modules we treat it as a source file.\n          if (!vendorRegex.test(modulePath)) {\n            return true\n          }\n\n          // If the module uses Gatsby as a dependency\n          // we want to treat it as src so we can extract queries\n          return modulesThatUseGatsby.some(module =>\n            modulePath.includes(module.path)\n          )\n        },\n        type: `javascript/auto`,\n        use: ({ issuer }): Array<RuleSetUseItem> => [\n          // If a JS import comes from async-requires, assume it is for a page component.\n          // Using `issuer` allows us to avoid mutating async-requires for this case.\n          //\n          // If other imports are added to async-requires in the future, another option is to\n          // append a query param to page components in the store and check against `resourceQuery` here.\n          //\n          // This would require we adjust `doesModuleMatchResourcePath` in `static-query-mapper`\n          // to check against the module's `resourceResolveData.path` instead of resource to avoid\n          // mismatches because of the added query param. Other adjustments may also be needed.\n          loaders.js({\n            ...options,\n            configFile: true,\n            compact: PRODUCTION,\n            isPageTemplate: /async-requires/.test(issuer),\n          }),\n        ],\n      }\n    }\n    rules.js = js\n  }\n\n  /**\n   * Node_modules JavaScript loader via babel\n   * Excludes core-js & babel-runtime to speedup babel transpilation\n   * Excludes modules that use Gatsby since the `rules.js` already transpiles those\n   */\n  {\n    const dependencies = ({\n      modulesThatUseGatsby = [],\n    }: {\n      modulesThatUseGatsby?: Array<IModuleThatUseGatsby>\n    } = {}): RuleSetRule => {\n      const jsOptions = {\n        babelrc: false,\n        configFile: false,\n        compact: false,\n        presets: [\n          [\n            require.resolve(`babel-preset-gatsby/dependencies`),\n            {\n              stage,\n            },\n          ],\n        ],\n        // If an error happens in a package, it's possible to be\n        // because it was compiled. Thus, we don't want the browser\n        // debugger to show the original code. Instead, the code\n        // being evaluated would be much more helpful.\n        sourceMaps: false,\n\n        cacheIdentifier: JSON.stringify({\n          browsersList: supportedBrowsers,\n          gatsbyPreset: require(`babel-preset-gatsby/package.json`).version,\n        }),\n      }\n\n      // TODO REMOVE IN V3\n      // a list of vendors we know we shouldn't polyfill (we should have set core-js to entry but we didn't so we have to do this)\n      const VENDORS_TO_NOT_POLYFILL = [\n        `@babel[\\\\\\\\/]runtime`,\n        `@mikaelkristiansson[\\\\\\\\/]domready`,\n        `@reach[\\\\\\\\/]router`,\n        `babel-preset-gatsby`,\n        `core-js`,\n        `dom-helpers`,\n        `gatsby-legacy-polyfills`,\n        `gatsby-link`,\n        `gatsby-react-router-scroll`,\n        `invariant`,\n        `lodash`,\n        `mitt`,\n        `prop-types`,\n        `react-dom`,\n        `react`,\n        `regenerator-runtime`,\n        `scheduler`,\n        `scroll-behavior`,\n        `shallow-compare`,\n        `warning`,\n        `webpack`,\n      ]\n      const doNotPolyfillRegex = new RegExp(\n        `[\\\\\\\\/]node_modules[\\\\\\\\/](${VENDORS_TO_NOT_POLYFILL.join(\n          `|`\n        )})[\\\\\\\\/]`\n      )\n\n      return {\n        test: /\\.(js|mjs)$/,\n        exclude: (modulePath: string): boolean => {\n          // If dep is user land code, exclude\n          if (!vendorRegex.test(modulePath)) {\n            return true\n          }\n\n          // If dep uses Gatsby, exclude\n          if (\n            modulesThatUseGatsby.some(module =>\n              modulePath.includes(module.path)\n            )\n          ) {\n            return true\n          }\n\n          return doNotPolyfillRegex.test(modulePath)\n        },\n        type: `javascript/auto`,\n        use: [loaders.dependencies(jsOptions)],\n      }\n    }\n    rules.dependencies = dependencies\n  }\n\n  rules.yaml = (): RuleSetRule => {\n    return {\n      test: /\\.ya?ml$/,\n      type: `json`,\n      use: [loaders.yaml()],\n    }\n  }\n\n  /**\n   * Font loader\n   */\n  rules.fonts = (): RuleSetRule => {\n    return {\n      use: [loaders.url()],\n      test: /\\.(eot|otf|ttf|woff(2)?)(\\?.*)?$/,\n    }\n  }\n\n  /**\n   * Loads image assets, inlines images via a data URI if they are below\n   * the size threshold\n   */\n  rules.images = (): RuleSetRule => {\n    return {\n      use: [loaders.url()],\n      test: /\\.(ico|svg|jpg|jpeg|png|gif|webp|avif)(\\?.*)?$/,\n    }\n  }\n\n  /**\n   * Loads audio and video and inlines them via a data URI if they are below\n   * the size threshold\n   */\n  rules.media = (): RuleSetRule => {\n    return {\n      use: [loaders.url()],\n      test: /\\.(mp4|webm|ogv|wav|mp3|m4a|aac|oga|flac)$/,\n    }\n  }\n\n  /**\n   * Loads assets without inlining\n   */\n  rules.miscAssets = (): RuleSetRule => {\n    return {\n      use: [loaders.file()],\n      test: /\\.pdf$/,\n    }\n  }\n\n  /**\n   * CSS style loader.\n   */\n  {\n    const css: IRuleUtils[\"css\"] = (options = {}): RuleSetRule => {\n      const { browsers, ...restOptions } = options\n      const use = [\n        !isSSR && loaders.miniCssExtract(restOptions),\n        loaders.css({ ...restOptions, importLoaders: 1 }),\n        loaders.postcss({ browsers }),\n      ].filter(Boolean) as RuleSetRule[\"use\"]\n\n      return {\n        use,\n        test: /\\.css$/,\n      }\n    }\n\n    /**\n     * CSS style loader, _excludes_ node_modules.\n     */\n    css.internal = makeInternalOnly(css)\n    css.external = makeExternalOnly(css)\n\n    const cssModules: IRuleUtils[\"cssModules\"] = (options): RuleSetRule => {\n      const rule = css({ ...options, modules: true })\n      delete rule.exclude\n      rule.test = /\\.module\\.css$/\n      return rule\n    }\n\n    rules.css = css\n    rules.cssModules = cssModules\n  }\n\n  /**\n   * PostCSS loader.\n   */\n  {\n    const postcss: ContextualRuleFactory = (options): RuleSetRule => {\n      return {\n        test: /\\.css$/,\n        use: [loaders.css({ importLoaders: 1 }), loaders.postcss(options)],\n      }\n    }\n\n    /**\n     * PostCSS loader, _excludes_ node_modules.\n     */\n    postcss.internal = makeInternalOnly(postcss)\n    postcss.external = makeExternalOnly(postcss)\n    rules.postcss = postcss\n  }\n  /**\n   * cast rules to IRuleUtils\n   */\n  /**\n   * Plugins\n   */\n  const plugins = { ...builtinPlugins } as PluginUtils\n\n  plugins.minifyJs = ({\n    terserOptions,\n    ...options\n  }: {\n    terserOptions?: TerserOptions\n  } = {}): WebpackPluginInstance =>\n    new TerserPlugin({\n      exclude: /\\.min\\.js/,\n      terserOptions: {\n        ie8: false,\n        mangle: {\n          safari10: true,\n        },\n        parse: {\n          ecma: 5,\n        },\n        compress: {\n          ecma: 5,\n        },\n        output: {\n          ecma: 5,\n        },\n        ...terserOptions,\n      },\n      parallel: Math.max(1, cpuCoreCount() - 1),\n      ...options,\n    })\n\n  plugins.minifyCss = (\n    options = {\n      minimizerOptions: {\n        preset: [\n          `default`,\n          {\n            svgo: {\n              full: true,\n              plugins: [\n                // potentially destructive plugins removed - see https://github.com/gatsbyjs/gatsby/issues/15629\n                // use correct config format and remove plugins requiring specific params - see https://github.com/gatsbyjs/gatsby/issues/31619\n                // List of default plugins and their defaults: https://github.com/svg/svgo#built-in-plugins\n                // Last update 2021-08-17\n                `cleanupAttrs`,\n                `cleanupEnableBackground`,\n                `cleanupIDs`,\n                `cleanupListOfValues`, // Default: disabled\n                `cleanupNumericValues`,\n                `collapseGroups`,\n                `convertColors`,\n                `convertPathData`,\n                `convertStyleToAttrs`, // Default: disabled\n                `convertTransform`,\n                `inlineStyles`,\n                `mergePaths`,\n                `minifyStyles`,\n                `moveElemsAttrsToGroup`,\n                `moveGroupAttrsToElems`,\n                `prefixIds`, // Default: disabled\n                `removeComments`,\n                `removeDesc`,\n                `removeDoctype`,\n                `removeEditorsNSData`,\n                `removeEmptyAttrs`,\n                `removeEmptyContainers`,\n                `removeEmptyText`,\n                `removeHiddenElems`,\n                `removeMetadata`,\n                `removeNonInheritableGroupAttrs`,\n                `removeOffCanvasPaths`, // Default: disabled\n                `removeRasterImages`, // Default: disabled\n                `removeScriptElement`, // Default: disabled\n                `removeStyleElement`, // Default: disabled\n                `removeTitle`,\n                `removeUnknownsAndDefaults`,\n                `removeUnusedNS`,\n                `removeUselessDefs`,\n                `removeUselessStrokeAndFill`,\n                `removeXMLProcInst`,\n                `reusePaths`, // Default: disabled\n                `sortAttrs`, // Default: disabled\n              ],\n            },\n          },\n        ],\n      },\n    }\n  ): CssMinimizerPlugin =>\n    new CssMinimizerPlugin({\n      parallel: Math.max(1, cpuCoreCount() - 1),\n      ...options,\n    })\n\n  plugins.fastRefresh = ({ modulesThatUseGatsby }): WebpackPluginInstance => {\n    const regExpToHack = /node_modules/\n    regExpToHack.test = (modulePath: string): boolean => {\n      // when it's not coming from node_modules we treat it as a source file.\n      if (!vendorRegex.test(modulePath)) {\n        return false\n      }\n\n      // If the module uses Gatsby as a dependency\n      // we want to treat it as src because of shadowing\n      return !modulesThatUseGatsby.some(module =>\n        modulePath.includes(module.path)\n      )\n    }\n\n    return new ReactRefreshWebpackPlugin({\n      overlay: {\n        sockIntegration: `whm`,\n        module: path.join(__dirname, `fast-refresh-module`),\n      },\n      // this is a bit hacky - exclude expect string or regexp or array of those\n      // so this is tricking ReactRefreshWebpackPlugin with providing regexp with\n      // overwritten .test method\n      exclude: regExpToHack,\n    })\n  }\n\n  plugins.extractText = (options: any): WebpackPluginInstance =>\n    new MiniCssExtractPlugin({\n      ...options,\n    })\n\n  plugins.moment = (): WebpackPluginInstance =>\n    plugins.ignore({ resourceRegExp: /^\\.\\/locale$/, contextRegExp: /moment$/ })\n\n  plugins.extractStats = (): GatsbyWebpackStatsExtractor =>\n    new GatsbyWebpackStatsExtractor()\n\n  plugins.eslintGraphqlSchemaReload =\n    (): GatsbyWebpackEslintGraphqlSchemaReload =>\n      new GatsbyWebpackEslintGraphqlSchemaReload()\n\n  plugins.virtualModules = (): GatsbyWebpackVirtualModules =>\n    new GatsbyWebpackVirtualModules()\n\n  plugins.eslint = (schema: GraphQLSchema): WebpackPluginInstance => {\n    const options = {\n      extensions: [`js`, `jsx`],\n      exclude: [\n        `/node_modules/`,\n        `/bower_components/`,\n        VIRTUAL_MODULES_BASE_PATH,\n      ],\n      ...eslintConfig(schema, config.jsxRuntime === `automatic`),\n    }\n    // @ts-ignore\n    return new ESLintPlugin(options)\n  }\n\n  plugins.eslintRequired = (): WebpackPluginInstance => {\n    const options = {\n      extensions: [`js`, `jsx`],\n      exclude: [\n        `/node_modules/`,\n        `/bower_components/`,\n        VIRTUAL_MODULES_BASE_PATH,\n      ],\n      ...eslintRequiredConfig,\n    }\n    // @ts-ignore\n    return new ESLintPlugin(options)\n  }\n\n  return {\n    loaders,\n    rules,\n    plugins,\n  }\n}\n"],"file":"webpack-utils.js"}