{"version":3,"sources":["../../../src/utils/tracer/index.ts"],"names":["tracerProvider","initTracer","tracerFile","tracer","process","env","GATSBY_OPEN_TRACING_CONFIG_FILE","resolvedPath","path","resolve","require","create","Tracer","stopTracer","stop"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAOA,IAAIA,cAAJ;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,MAAMC,UAAU,GAAG,MAAOC,UAAP,IAA+C;AACvE,MAAIC,MAAJ;;AACA,MAAID,UAAJ,EAAgB;AACdE,IAAAA,OAAO,CAACC,GAAR,CAAYC,+BAAZ,GAA8CJ,UAA9C;AACA,UAAMK,YAAY,GAAG,4BAAMC,cAAKC,OAAL,CAAaP,UAAb,CAAN,CAArB;AACAF,IAAAA,cAAc,GAAGU,OAAO,CAACH,YAAD,CAAxB;AACAJ,IAAAA,MAAM,GAAG,MAAMH,cAAc,CAAEW,MAAhB,EAAf;AACD,GALD,MAKO;AACLR,IAAAA,MAAM,GAAG,IAAIS,mBAAJ,EAAT,CADK,CACiB;AACvB;;AAED,qCAAiBT,MAAjB;AAEA,SAAOA,MAAP;AACD,CAdM;;;;AAgBA,MAAMU,UAAU,GAAG,YAA2B;AAAA;;AACnD,yBAAIb,cAAJ,4CAAI,gBAAgBc,IAApB,EAA0B;AACxB,UAAMd,cAAc,CAACc,IAAf,EAAN;AACD;AACF,CAJM","sourcesContent":["import { slash } from \"gatsby-core-utils\"\nimport path from \"path\"\nimport { Tracer, initGlobalTracer } from \"opentracing\"\n\ninterface ITracerProvider {\n  create(): Tracer\n  stop(): Promise<void>\n}\n\nlet tracerProvider: ITracerProvider | undefined\n\n/**\n * tracerFile should be a js file that exports two functions.\n *\n * `create` - Create and return an open-tracing compatible tracer. See\n * https://github.com/opentracing/opentracing-javascript/blob/master/src/tracer.ts\n *\n * `stop` - Run any tracer cleanup required before the node.js process\n * exits\n */\nexport const initTracer = async (tracerFile: string): Promise<Tracer> => {\n  let tracer: Tracer\n  if (tracerFile) {\n    process.env.GATSBY_OPEN_TRACING_CONFIG_FILE = tracerFile\n    const resolvedPath = slash(path.resolve(tracerFile))\n    tracerProvider = require(resolvedPath)\n    tracer = await tracerProvider!.create()\n  } else {\n    tracer = new Tracer() // Noop\n  }\n\n  initGlobalTracer(tracer)\n\n  return tracer\n}\n\nexport const stopTracer = async (): Promise<void> => {\n  if (tracerProvider?.stop) {\n    await tracerProvider.stop()\n  }\n}\n"],"file":"index.js"}