{"version":3,"sources":["../../../src/steps/create-schema-customization/helpers.js"],"names":["buildTypeName","name","schema","typePrefix","prefix","startsWith","findTypeName","type","ofType","findTypeKind","kind","fieldOfTypeWasFetched","fetchedTypes","store","getState","remoteSchema","typeName","typeWasFetched","get","supportedScalars","typeIsABuiltInScalar","includes","typeIsASupportedScalar","typeSettingCache","getTypeSettingsByType","cachedTypeSettings","allTypeSettings","gatsbyApi","pluginOptions","typeSettings","__allTypeSetting","__all","limit","mergedSettings","filterTypeDefinition","typeDefinition","typeBuilderApi","typeKind","filters","typeDefinitionFilters","filter","length","forEach","typeDef"],"mappings":"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","sourcesContent":["import store from \"~/store\"\nimport { typeDefinitionFilters } from \"./type-filters\"\nimport { getPluginOptions } from \"~/utils/get-gatsby-api\"\nimport { cloneDeep, merge } from \"lodash\"\n\n/**\n * This function namespaces typenames with a prefix\n */\nexport const buildTypeName = name => {\n  if (!name || typeof name !== `string`) {\n    return null\n  }\n\n  const {\n    schema: { typePrefix: prefix },\n  } = getPluginOptions()\n\n  // this is for our namespace type on the root { wp { ...fields } }\n  if (name === prefix) {\n    return name\n  }\n\n  if (name === `Filter`) {\n    name = `FilterType`\n  }\n\n  if (name.startsWith(prefix)) {\n    return name\n  }\n\n  return prefix + name\n}\n\n/**\n * Find the first type name of a Type definition pulled via introspection\n * @param {object} type\n */\nexport const findTypeName = type =>\n  type?.name ||\n  type?.ofType?.name ||\n  type?.ofType?.ofType?.name ||\n  type?.ofType?.ofType?.ofType?.name\n\n/**\n * Find the first type kind of a Type definition pulled via introspection\n * @param {object} type\n */\nexport const findTypeKind = type =>\n  type?.kind ||\n  type?.ofType?.kind ||\n  type?.ofType?.ofType?.kind ||\n  type?.ofType?.ofType?.ofType?.kind\n\nexport const fieldOfTypeWasFetched = type => {\n  const { fetchedTypes } = store.getState().remoteSchema\n  const typeName = findTypeName(type)\n  const typeWasFetched = !!fetchedTypes.get(typeName)\n\n  return typeWasFetched\n}\n\nconst supportedScalars = [\n  `Int`,\n  `Float`,\n  `String`,\n  `Boolean`,\n  `ID`,\n  `Date`,\n  `JSON`,\n]\n\nexport const typeIsABuiltInScalar = type =>\n  // @todo the next function and this one are redundant.\n  // see the next todo on how to fix the issue. If that todo is resolved, these functions will be identical. :(\n  supportedScalars.includes(findTypeName(type))\n\nexport const typeIsASupportedScalar = type => {\n  if (findTypeKind(type) !== `SCALAR`) {\n    // @todo returning true here seems wrong since a type that is not a scalar can't be a supported scalar... so there is some other logic elsewhere that is wrong\n    // making this return false causes errors in the schema\n    return true\n  }\n\n  return supportedScalars.includes(findTypeName(type))\n}\n\nconst typeSettingCache = {}\n\n// retrieves plugin settings for the provided type\nexport const getTypeSettingsByType = type => {\n  if (!type) {\n    return {}\n  }\n\n  const typeName = findTypeName(type)\n\n  const cachedTypeSettings = typeSettingCache[typeName]\n\n  if (cachedTypeSettings) {\n    return cachedTypeSettings\n  }\n\n  // the plugin options object containing every type setting\n  const allTypeSettings = store.getState().gatsbyApi.pluginOptions.type\n\n  const typeSettings = cloneDeep(allTypeSettings[typeName] || {})\n\n  // the type.__all plugin option which is applied to every type setting\n  const __allTypeSetting = cloneDeep(allTypeSettings.__all || {})\n\n  if (typeName === `MediaItem`) {\n    delete __allTypeSetting.limit\n    delete typeSettings.limit\n  }\n\n  if (typeSettings) {\n    const mergedSettings = merge(__allTypeSetting, typeSettings)\n\n    typeSettingCache[typeName] = mergedSettings\n\n    return mergedSettings\n  }\n\n  typeSettingCache[typeName] = __allTypeSetting\n\n  return __allTypeSetting\n}\n\n/**\n * This is used to filter the automatically generated type definitions before they're added to the schema customization api.\n */\nexport const filterTypeDefinition = (\n  typeDefinition,\n  typeBuilderApi,\n  typeKind\n) => {\n  const filters = typeDefinitionFilters.filter(filter =>\n    [typeBuilderApi.type.name, `__all`].includes(filter.typeName)\n  )\n\n  if (filters?.length) {\n    filters.forEach(filter => {\n      if (filter && typeof filter.typeDef === `function`) {\n        typeDefinition = filter.typeDef(\n          typeDefinition,\n          typeBuilderApi,\n          typeKind\n        )\n      }\n    })\n  }\n\n  return typeDefinition\n}\n"],"file":"helpers.js"}